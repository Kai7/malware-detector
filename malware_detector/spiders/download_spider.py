# -*- coding: utf-8 -*-
import scrapy
from scrapy.http import Request
import subprocess

class QuotesSpider(scrapy.Spider):
    name = "downloads"

    def start_requests(self):
        domain = 'http://download.cnet.com/s/software/windows/'
        urls = ['{}?page={}'.format(domain, i) for i in range(1, 2)]
        for url in urls:
            yield scrapy.Request(url=url, callback=self.parse_page)

    def parse_page(self, response):
        for link in response.xpath('//*[@id="search-results"]/a/@href').extract():
            yield scrapy.Request(url=link, callback=self.parse_download_link)

    def parse_download_link(self, response):
        download_link = response.xpath('//*[@id="product-upper-container"]/div[1]/div[1]/div/@data-dl-url').extract()[0]
        subprocess.call(["wget", "-P", "/Users/joychen/code/trend_micro_project/benign/", download_link])
